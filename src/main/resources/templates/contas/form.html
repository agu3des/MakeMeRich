<html xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{layouts/principal}" th:with="titulo='Nova Conta'">
  <body>
    <div layout:fragment="conteudo">
      <form th:action="@{/contas}" method="POST" th:object="${conta}">
        <input type="hidden" th:field="*{id}" />

        <div class="form-group mx-sm-3 mb-2">
          <label for="numero">Número</label>
          <input type="text" th:field="*{numero}" class="form-control" />
        </div>

        <div class="form-group mx-sm-3 mb-2">
          <label for="descricao">Descrição</label>
          <input type="text" th:field="*{descricao}" class="form-control" />
        </div>

        <div class="form-group mx-sm-3 mb-2">
          <label for="tipo">Tipo de Conta</label>
          <select th:field="*{tipo}" class="form-select" id="tipoConta" onchange="exibirOuOcultarFechamento()">
            <option value="">-- Selecione --</option>
            <option value="CORRENTE" th:selected="${conta.tipo == 'CORRENTE'}">Corrente</option>
            <option value="CARTAO" th:selected="${conta.tipo == 'CARTAO'}">Cartão</option>
          </select>
        </div>

        <div class="form-group mx-sm-3 mb-2">
          <label for="diaFechamento">Dia do Fechamento</label>
          <input type="number" th:field="*{diaFechamento}" class="form-control" min="1" max="31"
            id="diaFechamento"
            th:disabled="${conta.tipo == null or conta.tipo == 'CORRENTE'}" />
        </div>
        
 <!-- Campo de correntista modificado -->
        <div th:if="${session.usuario.admin}">
          <div class="form-group mx-sm-3 mb-2">
            <label for="correntista.id">Correntista</label>
            <select th:field="*{correntista.id}" class="form-select">
              <option th:each="cor : ${correntistaItems}" th:value="${cor.id}" th:label="${cor.nome}"></option>
            </select>
          </div>
        </div>

        <div th:unless="${session.usuario.admin}">
          <input type="hidden" th:field="*{correntista.id}" th:value="${session.usuario.id}" />
          <div class="form-group mx-sm-3 mb-2">
            <label>Correntista</label>
            <p class="form-control-static" th:text="${session.usuario.nome}"></p>
          </div>
        </div>
        
        <button type="submit" class="btn btn-primary">Salvar</button>
        <a class="btn btn-secondary" th:href="@{/contas}">Cancelar</a>
      </form>

      <script>
        function ajustarCampoFechamento() {
          const tipo = document.getElementById("tipoConta").value;
          const inputFechamento = document.getElementById("diaFechamento");

          if (tipo === "CARTAO") {
            inputFechamento.removeAttribute("disabled");
          } else {
            inputFechamento.setAttribute("disabled", "disabled");
            inputFechamento.value = "";
          }
        }

        window.addEventListener("DOMContentLoaded", ajustarCampoFechamento);
        document.getElementById("tipoConta").addEventListener("change", ajustarCampoFechamento);
      </script>
    </div>
  </body>
</html>
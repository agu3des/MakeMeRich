<html xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" 
      layout:decorate="~{layouts/principal}" 
      th:with="titulo='Contas'">
  <body>
    <div layout:fragment="conteudo">
      <div class="container py-3">
        <!-- Botão Nova Conta -->
        <form th:action="@{/contas/form}" method="GET" class="mb-3">
          <button class="btn btn-success" type="submit">
            <i class="bi bi-plus-circle"></i> 
            <span class="d-none d-sm-inline">Nova Conta</span>
          </button>
        </form>

        <!-- Lista de contas -->
        <div th:if="${not #lists.isEmpty(contas)}">
          <div class="d-flex justify-content-end mb-2 text-muted small">
            <span th:text="'Total ' + ${#lists.size(contas)} + ' registros'"></span>
          </div>

          <div class="table-responsive shadow-sm border border-success rounded">
            <table class="table table-hover align-middle mb-0">
              <thead class="table-success">
                <tr class="table-success">
                  <th class="fw-bold text-success">Número</th>
                  <th class="fw-bold text-success">Descrição</th>
                  <th class="fw-bold text-success">Correntista</th>
                  <th class="fw-bold text-success">Tipo</th>
                  <th class="text-center fw-bold text-success">Dia Fechamento</th>
                  <th class="fw-bold text-success">Ações</th>
                </tr>
              </thead>
              <tbody>
                <tr th:each="conta : ${contas}">
                  <td>
                    <a th:href="@{/contas/{id}(id=${conta.id})}" 
                       th:text="${conta.numero}" 
                       class="text-success text-decoration-none fw-semibold"></a>
                  </td>
                  <td th:text="${conta.descricao}"></td>
                  <td th:text="${conta.correntista.nome}"></td>
                  <td>
                    <span th:if="${conta.tipo == 'CARTAO'}" class="badge bg-warning text-dark">Cartão</span>
                    <span th:if="${conta.tipo == 'CORRENTE'}" class="badge bg-success">Corrente</span>
                  </td>
                  <td class="text-center">
                    <span th:if="${conta.tipo == 'CARTAO'}" th:text="${conta.diaFechamento}"></span>
                    <span th:if="${conta.tipo != 'CARTAO'}">–</span>
                  </td>
                  <td>
                  <div class="d-flex flex-wrap gap-1">
                    <a th:href="@{/transacoes/listar/{id}(id=${conta.id})}" class="btn btn-outline-success btn-sm btn-icon-sm"
                      data-bs-toggle="tooltip" data-bs-placement="top" title="Ver transações">
                      <i class="bi bi-list-ul"></i> 
                    </a>
                    <a th:href="@{/transacoes/nova/{id}(id=${conta.id})}" class="btn btn-outline-primary btn-sm btn-icon-sm"
                      data-bs-toggle="tooltip" data-bs-placement="top" title="Nova transação"> 
                      <i class="bi bi-plus-circle"></i> 
                    </a>
                    <a th:href="@{/contas/orcamento/anual(correntistaId=${conta.correntista.id}, exibirSelecaoCorrentista=false)}" 
                      class="btn btn-outline-info btn-sm btn-icon-sm"
                      data-bs-toggle="tooltip" data-bs-placement="top" title="Orçamento anual">
                      <i class="bi bi-pie-chart"></i>
                    </a>

                    <form method="get"
                          th:action="@{/grafico/{idConta}(idConta=${conta.id})}"
                          class="d-flex align-items-center gap-2 mb-3">
                      <input type="hidden" name="ano" th:value="${anoSelecionado}" />
                      <button type="submit" class="btn btn-outline-secondary btn-sm btn-icon-sm"
                      data-bs-toggle="tooltip" data-bs-placement="top" title="Gráfico de gastos">
                        <i class="bi bi-bar-chart-line"></i> 
                      </button>
                    </form>

                    <a th:href="@{/contas/editar/{id}(id=${conta.id})}" 
                      class="btn btn-outline-warning btn-sm btn-icon-sm" 
                      data-bs-toggle="tooltip" data-bs-placement="top" title="Editar"
                      >
                      <i class="bi bi-pencil"></i>
                    </a>
                    <!-- E
                     xclusão apenas para admin -->
                    <form th:action="@{/contas/{id}/delete(id=${conta.id})}" method="GET">
                      <button type="submit" class="btn btn-outline-danger btn-sm btn-icon-sm"
                      data-bs-toggle="tooltip" data-bs-placement="top" title="Excluir conta">
                        <i class="bi bi-trash"></i> 
                      </button>
                    </form>
                  </div>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <!-- Nenhuma conta -->
        <div th:if="${#lists.isEmpty(contas)}" class="alert alert-info mt-3">
          Nenhuma conta cadastrada.
        </div>
      </div>
    </div>
  </body>
</html>
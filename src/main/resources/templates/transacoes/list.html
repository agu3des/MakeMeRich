<html xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/principal}" 
      th:with="titulo='Transações na conta'">
  <body>
    <div layout:fragment="conteudo">
      <ul>
        <li>
          Conta:
          <span th:text="${conta.numero}"></span>
        </li>
        <li>
          Correntista:
          <span th:text="${conta.correntista.nome}"></span>
        </li>
        <li>
          Dia fechamento:
          <span th:text="${conta.diaFechamento} ?: '–'"></span>
        </li>
      </ul>

      <div style="margin-bottom: 30px"></div>

      <table class="table table-striped table-hover">
        <thead>
          <tr>
            <th>ID</th>
            <th>Descricao</th>
            <th>Data</th>
            <th style="text-align: right">Valor</th>
            <th>Movimento</th>
            <th>Categoria</th>
            <th>Comentários</th>
            <th>Ações</th>
          </tr>
        </thead>
        <tbody>
          <tr th:each="transacao : ${conta.transacoes}">
            <td th:text="${transacao.id}"></td>
            <td th:text="${transacao.descricao}"></td>
            <td th:text="${transacao.data != null} ? ${#temporals.format(transacao.data, 'dd/MM/yyyy')} : '-'"></td>
            <td style="text-align: right" 
                th:text="${#numbers.formatCurrency(transacao.valor)}"></td>
            <td th:text="${transacao.movimento}"></td>
            <td th:text="${transacao.categoria != null} ? ${transacao.categoria.nome} : '—'"></td>
            <td>
              <div th:if="${#lists.isEmpty(transacao.comentarios)}">
                Sem comentários
              </div>
              <ul th:if="${!#lists.isEmpty(transacao.comentarios)}" style="padding-left: 1rem;">
                <li th:each="comentario : ${transacao.comentarios}">
                  <span th:text="${comentario.texto}"></span>
                </li>
              </ul>
            </td>
            <td>
              <a th:href="@{/comentarios/listar/{id}(id=${transacao.id})}" 
                 class="btn btn-sm btn-info mt-2">Comentários</a>
              <a th:href="@{/transacoes/editar/{id}(id=${transacao.id})}" 
                 class="btn btn-sm btn-warning mt-2">Editar</a>
            </td>
          </tr>

          <tr>
            <th colspan="7" style="font-weight: bold; background-color: darkgray; text-align: right;">Total</th>
            <td style="font-weight: bold; background-color: darkgray; text-align: center;" 
                th:text="${conta.saldo != null} ? ${#numbers.formatCurrency(conta.saldo)} : 'R$ 0,00'"></td>
          </tr>
        </tbody>
      </table>
      
      <div class="mt-3">
        <a th:href="@{/contas}" class="btn btn-secondary">Voltar para Contas</a>
      </div>
    </div>
  </body>
</html>